# Gmail Agent OAuth 2.0 Setup Guide

## ğŸš€ Complete Setup Process

This guide will help you set up OAuth 2.0 authentication for the Gmail Agent, allowing users to authenticate with their Google accounts securely.

## ğŸ“‹ Prerequisites

- Google Cloud Platform account
- Python 3.8+
- Web browser for OAuth flow

## ğŸ”§ Step 1: Google Cloud Console Setup

### 1.1 Create a Google Cloud Project

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Click "Select a project" â†’ "New Project"
3. Enter project name: `gmail-agent-oauth`
4. Click "Create"

### 1.2 Enable Gmail API

1. In the Google Cloud Console, go to "APIs & Services" â†’ "Library"
2. Search for "Gmail API"
3. Click on "Gmail API" â†’ "Enable"

### 1.3 Create OAuth 2.0 Credentials

1. Go to "APIs & Services" â†’ "Credentials"
2. Click "Create Credentials" â†’ "OAuth client ID"
3. If prompted, configure the OAuth consent screen:
   - Choose "External" user type
   - Fill in required fields:
     - App name: `Gmail Agent`
     - User support email: Your email
     - Developer contact: Your email
   - Add scopes: `https://www.googleapis.com/auth/gmail.send`
   - Add test users (your email address)
4. Choose "Desktop application" as application type
5. Name it: `Gmail Agent Desktop Client`
6. Click "Create"
7. **Download the JSON file** and save it as `credentials.json` in the gmail_agent folder

## ğŸ”§ Step 2: Install Dependencies

```bash
cd src/agents/new-agents/gmail_agent/
pip install -r requirements.txt
```

## ğŸ”§ Step 3: First-Time Authentication

### 3.1 Run the OAuth Setup

```bash
python oauth_setup.py
```

This will:
- Open your browser for Google authentication
- Request permission to send emails on your behalf
- Save the token for future use

### 3.2 Test the Setup

```bash
python test_oauth_gmail.py
```

## ğŸ“ File Structure After Setup

```
gmail_agent/
â”œâ”€â”€ credentials.json          # OAuth client credentials (from Google Cloud)
â”œâ”€â”€ token.json               # User access token (generated by oauth_setup.py)
â”œâ”€â”€ gmail_agent.py           # Main agent with OAuth support
â”œâ”€â”€ oauth_setup.py           # OAuth authentication script
â””â”€â”€ test_oauth_gmail.py      # Test script
```

## ğŸ” Security Notes

- **Never commit `credentials.json` or `token.json` to version control**
- Add these files to `.gitignore`
- The `token.json` contains your personal access token
- Share only `credentials.json` with other developers (they'll need their own tokens)

## ğŸš¨ Troubleshooting

### "Access blocked" Error
- Make sure you added your email as a test user in OAuth consent screen
- Check that the Gmail API is enabled

### "Invalid credentials" Error
- Delete `token.json` and run `python oauth_setup.py` again
- Verify `credentials.json` is in the correct location

### "Insufficient permissions" Error
- Make sure the OAuth consent screen includes the Gmail send scope
- Re-authenticate by deleting `token.json`

## ğŸ¯ What Happens During OAuth Flow

1. **User starts Gmail agent** â†’ Agent checks for valid token
2. **No token found** â†’ Agent prompts user to authenticate
3. **User clicks "Authenticate"** â†’ Browser opens to Google OAuth
4. **User grants permission** â†’ Google returns authorization code
5. **Agent exchanges code for token** â†’ Token saved to `token.json`
6. **Future requests** â†’ Agent uses saved token automatically

## ğŸ”„ Token Refresh

The OAuth token will automatically refresh when needed. Users don't need to re-authenticate unless:
- Token expires and refresh fails
- User revokes access in Google Account settings
- `token.json` is deleted

## ğŸ“± User Experience

When a user without credentials tries to send an email:

```
âŒ Gmail authentication required!

To send emails, you need to authenticate with your Google account.

ğŸ”— Click here to authenticate: [Authenticate with Google]

This will:
âœ… Open your browser
âœ… Request permission to send emails
âœ… Save credentials securely
âœ… Enable email sending

After authentication, you can send emails normally!
```

## ğŸš€ Production Deployment

For production deployment:

1. **Use service account** instead of OAuth for server-to-server communication
2. **Set up proper domain verification** for OAuth consent screen
3. **Configure redirect URIs** for your domain
4. **Use environment variables** for sensitive configuration
5. **Implement proper error handling** and logging

## ğŸ“ Support

If you encounter issues:
1. Check the troubleshooting section above
2. Verify all steps in Google Cloud Console
3. Ensure proper file permissions
4. Check Python dependencies are installed correctly
